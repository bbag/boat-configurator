<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Dopple Boat</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <!-- <div class="progress-indicator">
            <div class="progress-dot active" data-target="0"></div>
            <div class="progress-dot" data-target="1"></div>
            <div class="progress-dot" data-target="2"></div>
            <div class="progress-dot" data-target="3"></div>
        </div> -->
		<div class="backdrops">
            <div class="backdrop-item">
                <img src="backdrop1.jpg" />
            </div>
            <div class="backdrop-item inactive-after">
                <img src="backdrop2.jpg" />
            </div>
            <div class="backdrop-item inactive-after">
                <img src="backdrop1.jpg" />
            </div>
            <div class="backdrop-item inactive-after">
                <img src="backdrop2.jpg" />
            </div>
		</div>
        <div id="scroll-wrapper">
            <div id="scroll-content">
                <section class="section" id="section-1" data-section="1">
                    <div class="section-content">
                        <div class="section-content-inner">
                            <div class="text-reveal-wrapper">
                                <h2 class="section-heading">Build the boat of your dreams.</h2>
                            </div>
                            <div class="text-reveal-wrapper">
                                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Beatae, error!</p>
                            </div>
                            <div class="cta">
                                <button data-target="#section-2" class="section-nav-button">Get Started</button>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="section" id="section-2" data-section="2">
                    <div class="section-content" data-side="right">
                        <div class="section-content-inner">
                            <div class="text-reveal-wrapper">
                                <h2 class="section-heading">Lorem ipsum dolor sit.</h2>
                            </div>
                            <div class="text-reveal-wrapper">
                                <p>
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Adipisci, inventore. Nostrum ipsam cumque tenetur possimus rem, magnam mollitia sequi nulla odio rerum.
                                </p>
                            </div>
                            <div class="cta">
                                <button data-target="#section-3" class="section-nav-button">Next</button>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="section" id="section-3" data-section="3">
                    <div class="section-content" data-side="left">
                        <div class="section-content-inner">
                            <div class="text-reveal-wrapper">
                                <h2 class="section-heading">Lorem ipsum dolor sit.</h2>
                            </div>
                            <div class="text-reveal-wrapper">
                                <p>
                                    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Officia, quasi. Iusto voluptates mollitia, laborum doloremque quos alias similique consequatur at veniam quod illum.
                                </p>
                            </div>
                            <div class="cta">
                                <button data-target="#section-4" class="section-nav-button">Next</button>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="section" id="section-4" data-section="4">
                    <div class="section-content">
                        <div class="section-content-inner">
                            <div class="text-reveal-wrapper">
                                <h2 class="section-heading">Start building now.</h2>
                            </div>
                            <div class="text-reveal-wrapper">
                                <p>
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorum, soluta? Esse, omnis.
                                </p>
                            </div>
                            <div class="cta">
                                <button id="start-config-button" class="section-nav-button">Begin Customizing.</button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <!-- GSAP v3 stuff -->
        <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollSmoother.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollToPlugin.min.js"></script>
        <script>
            document.body.scrollTop = 0
            document.documentElement.scrollTop = 0

            const backdropItems = document.querySelectorAll('.backdrop-item')
            const sections = document.querySelectorAll('.section')

            gsap.registerPlugin(ScrollTrigger, ScrollSmoother)

            const smoother = ScrollSmoother.create({
                wrapper: '#scroll-wrapper',
                content: '#scroll-content',
                smooth: 2,
                effects: true,
                smoothTouch: 0.1,
                normalizeScroll: true
            })

            let currentSection = 0

            function handleSectionEnter(sectionIndex) {
                
                const prevSection = currentSection
                currentSection = sectionIndex

                // console.log('scrolled to section index ' + currentSection + ' from ' + prevSection)
                console.log(`${prevSection} -> ${currentSection}`)

                // document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                //     dot.classList.toggle('active', index === sectionIndex)
                // })

                backdropItems.forEach((backdrop, index) => {
                    if (index < sectionIndex) {
                        backdrop.classList.add('inactive-before')
                    } else if (index > sectionIndex) {
                        backdrop.classList.add('inactive-after')
                    } else {
                        backdrop.classList.remove('inactive-before')
                        backdrop.classList.remove('inactive-after')
                    }
                })

                switch (sectionIndex) {
                    case 0:
                        document.body.style.setProperty('--bg', '#d7eaf2')
                        break
                    case 1:
                        document.body.style.setProperty('--bg', '#c5daea')
                        break
                    case 2:
                        document.body.style.setProperty('--bg', '#b0c6e5')
                        break
                    case 3:
                        document.body.style.setProperty('--bg', '#a1b6e0')
                        break
                }
            }

            function initializePage() {
                sections.forEach((section, index) => {
                    const content = section.querySelector('.section-content')
                    const heading = section.querySelector('.section-heading')
                    const side = section.querySelector('[data-side]')?.dataset.side

                    switch (side) {
                        case 'left':
                            console.log('found a left section')
                            break
                        case 'right':
                            console.log('found a left section')
                        default:
                            console.log('found a section with no side')
                            break
                    }

                    const tl = gsap.timeline({
                        scrollTrigger: {
                            trigger: section,
                            start: 'top 60%',
                            end: 'bottom 40%',
                            toggleActions: 'play none none reverse'
                        }
                    })

                    tl.fromTo(
                        heading,
                        {
                            y: '100%',
                            opacity: 0
                        },
                        {
                            y: '0%',
                            opacity: 1,
                            duration: 1.5,
                            ease: 'power3.out',
                            delay: 0.25,
                            stagger: {
                                amount: 0.6,
                                from: 'start'
                            }
                        }
                    )

                    tl.fromTo(
                        content.querySelector('p'),
                        {
                            opacity: 0,
                            y: 30
                        },
                        {
                            opacity: 1,
                            y: 0,
                            duration: 1.5,
                            ease: 'power3.out',
                            stagger: 0.6
                        },
                        '-=1.1' // Start slightly before headings finish
                    )

                    if (content.querySelector('.cta')) {
                        // Then animate the rest of the content
                        tl.fromTo(
                            content.querySelector('.cta'),
                            {
                                opacity: 0,
                                y: 30
                            },
                            {
                                opacity: 1,
                                y: 0,
                                duration: 1.5,
                                ease: 'power3.out',
                                stagger: 0.6
                            },
                            '-=1.1' // Start slightly before paragraphs finish
                        )
                    }

                    ScrollTrigger.create({
                        trigger: section,
                        start: 'top 50%',
                        end: 'bottom 50%',
                        onEnter: () => handleSectionEnter(index),
                        onEnterBack: () => handleSectionEnter(index)
                    })

                    const sectionNavButton = section.querySelector('button[data-target]')
                    if (sectionNavButton) {
                        sectionNavButton.addEventListener('click', () => {
                            const targetSection = document.querySelector(sectionNavButton.dataset.target)
                            smoother.scrollTo(targetSection, true, 'power3.inOut')
                        })
                    }
                })
            }

            // document.querySelectorAll('.progress-dot').forEach((dot, index) => {
            //     dot.addEventListener('click', () => {
            //         const targetSection = document.querySelector(`[data-section="${index}"]`)
            //         smoother.scrollTo(targetSection, true, 'power3.inOut')
            //     })
            // })

            document.addEventListener('DOMContentLoaded', () => {
                initializePage()
                handleSectionEnter(0)
            })

            window.addEventListener('load', () => {
                ScrollTrigger.refresh()
            })
        </script>
    </body>
</html>
